@t1 = {1, 2, 3, 4}
@t2 = {"a", "b", "c", "d"}

print("foreach")
iter(ipairs(t2)):foreach([k,v](print(k,v)))

assert( iter(ipairs(t1)):reduce([a, i, v](^^a+v)) == 10 )

assert( iter(ipairs(t1)):fold(10, [a, i, v](^^a+v)) == 20 )

assert( iter(pairs(t2)):count() == 4 )

assert( iter(ivalues(t2)):last() == "d" )

assert( iter(ivalues(t2)):nth(2) == "b" )

@t3 = iter(ivalues(t2)):collect()

assert( iter(ivalues(t2)):compare(iter(ivalues(t3))) == 0 )

assert( iter(ivalues(t1)):all([v](^^v>0)) )

assert( iter(ivalues(t1)):any([v](^^v==3)) )

assert( iter(ipairs(t2)):find([i,v](^^v=="c")) == 3 )

assert( iter(ipairs(t2)):position([i,v](^^v=="c")) == 3 )

assert( iter(values(t1)):min() == 1 )

assert( iter(ivalues(t1)):min([a,b](^^a<b)) == 1 )

assert( iter(ivalues(t1)):max() == 4 )

assert( iter(values(t1)):max([a,b](^^a<b)) == 4 )

assert( iter(ivalues(t1)):map([v](^^t2.(v))):compare(iter(ivalues(t2))) == 0 )

assert( iter(ivalues(t1)):chain(iter(ivalues(t2))):count() == 8)

assert( iter(ivalues(t1)):filter([v](^^v<=2)):count() == 2 )

print("enumerate")
iter(ivalues(t2)):enumerate():foreach([i,v](print(i,v)))

print("inspect and skip")
assert(
    iter(ivalues(t1)):
    inspect([v](print("check:", v))):
    skip(2):inspect([v](print("used: ", v))):
    count() == 2
)

assert( iter(ivalues(t1)):take(2):count() == 2 )
